!function(s){"use strict";try{chrome.extension.getBackgroundPage().tgs.setViewGlobals(s)}catch(s){return void window.setTimeout((()=>window.location.reload()),1e3)}async function e(s,e,n){const t=await gsIndexedDb.fetchSessionBySessionId(s);if(!t||!t.windows)return;gsUtils.removeInternalUrlsFromSession(t);let o=[];e?o.push(gsUtils.getWindowFromSession(e,t)):o=t.windows;for(let s of o){const e=n?1:2;await gsSession.restoreSessionWindow(s,null,e)}}function n(s,e,n,o){var l,r;gsIndexedDb.removeTabFromSessionHistory(e,n,o).then((function(e){gsUtils.removeInternalUrlsFromSession(e),e?(l=s.parentElement.parentElement,r=i(e),l.parentElement.replaceChild(r,l),t(r,e.sessionId)):window.location.reload()}))}async function t(s,e){var n=s.getElementsByClassName("sessionContents")[0],t=s.getElementsByClassName("sessionIcon")[0];t.classList.contains("icon-plus-squared-alt")?(t.classList.remove("icon-plus-squared-alt"),t.classList.add("icon-minus-squared-alt")):(t.classList.remove("icon-minus-squared-alt"),t.classList.add("icon-plus-squared-alt")),n.childElementCount>0?n.innerHTML="":gsIndexedDb.fetchSessionBySessionId(e).then((async function(s){if(s&&s.windows){gsUtils.removeInternalUrlsFromSession(s);for(const[e,t]of s.windows.entries()){t.sessionId=s.sessionId,n.appendChild(l(s,t,e));const o=[];for(const e of t.tabs)e.windowId=t.id,e.sessionId=s.sessionId,e.title=gsUtils.getCleanTabTitle(e),gsUtils.isSuspendedTab(e)&&(e.url=gsUtils.getOriginalUrl(e.url)),o.push(r(s,t,e));const i=await Promise.all(o);for(const s of i)n.appendChild(s)}}}))}function o(s,e){s&&(s.onclick=e)}function i(s){var n=historyItems.createSessionHtml(s,!0);return o(n.getElementsByClassName("sessionIcon")[0],(function(){t(n,s.sessionId)})),o(n.getElementsByClassName("sessionLink")[0],(function(){t(n,s.sessionId)})),o(n.getElementsByClassName("exportLink")[0],(function(){historyUtils.exportSessionWithId(s.sessionId)})),o(n.getElementsByClassName("resuspendLink")[0],(function(){e(s.sessionId,null,!0)})),o(n.getElementsByClassName("reloadLink")[0],(function(){e(s.sessionId,null,!1)})),o(n.getElementsByClassName("saveLink")[0],(function(){historyUtils.saveSession(s.sessionId)})),o(n.getElementsByClassName("deleteLink")[0],(function(){var e;e=s.sessionId,window.confirm(chrome.i18n.getMessage("js_history_confirm_delete"))&&gsIndexedDb.removeSessionFromHistory(e).then((function(){window.location.reload()}))})),n}function l(s,n,t){var i=s.sessionId!==gsSession.getSessionId(),l=historyItems.createWindowHtml(n,t,i);return o(l.getElementsByClassName("resuspendLink")[0],(function(){e(s.sessionId,n.id,!0)})),o(l.getElementsByClassName("reloadLink")[0],(function(){e(s.sessionId,n.id,!1)})),l}async function r(s,e,t){var i=s.sessionId!==gsSession.getSessionId(),l=await historyItems.createTabHtml(t,i);return o(l.getElementsByClassName("removeLink")[0],(function(){n(l,s.sessionId,e.id,t.id)})),l}gsUtils.documentReadyAndLocalisedAsPromsied(document).then((function(){var s,e,n,t,o,l;s=document.getElementById("currentSessions"),e=document.getElementById("recoverySessions"),n=document.getElementById("historySessions"),t=document.getElementById("importSession"),o=document.getElementById("importSessionAction"),l=!0,s.innerHTML="",e.innerHTML="",n.innerHTML="",gsIndexedDb.fetchCurrentSessions().then((function(n){n.forEach((function(n,t){gsUtils.removeInternalUrlsFromSession(n);var o=i(n);l?(s.appendChild(o),l=!1):e.appendChild(o)}))})),gsIndexedDb.fetchSavedSessions().then((function(s){s.forEach((function(s,e){gsUtils.removeInternalUrlsFromSession(s);var t=i(s);n.appendChild(t)}))})),o.addEventListener("change",historyUtils.importSession,!1),t.onclick=function(){o.click()},chrome.extension.inIncognitoContext&&Array.prototype.forEach.call(document.getElementsByClassName("noIncognito"),(function(s){s.style.display="none"}))}))}(this);