var historyUtils=function(e){"use strict";if(chrome.extension.getBackgroundPage()&&chrome.extension.getBackgroundPage().tgs){chrome.extension.getBackgroundPage().tgs.setViewGlobals(e);var n=function(){};return{importSession:function(e){var n=e.target.files[0];if(n){var t=new FileReader;t.onload=function(e){var t=e.target.result;"text/plain"!==n.type?alert(chrome.i18n.getMessage("js_history_import_fail")):async function(e,n){if(e=window.prompt(chrome.i18n.getMessage("js_history_enter_name_for_session"),e)){if(!await new Promise((n=>{i(e,(function(e){n(e)}))})))return;var t="_"+gsUtils.generateHashCode(e),s=[],o=function(){return{id:t+"_"+s.length,tabs:[]}},a=o();for(const e of n.split("\n")){if("string"!=typeof e)continue;if(""===e){a.tabs.length>0&&(s.push(a),a=o());continue}if(e.indexOf("://")<0)continue;const n={windowId:a.id,sessionId:t,id:a.id+"_"+a.tabs.length,url:e,title:e,index:a.tabs.length,pinned:!1},i=await gsIndexedDb.fetchTabInfo(e);i&&(n.title=i.title,n.favIconUrl=i.favIconUrl),a.tabs.push(n)}a.tabs.length>0&&s.push(a);var r={name:e,sessionId:t,windows:s,date:(new Date).toISOString()};await gsIndexedDb.updateSession(r)}}(n.name,t).then((function(){window.location.reload()}))},t.readAsText(n)}else alert(chrome.i18n.getMessage("js_history_import_fail"))},exportSession:t,exportSessionWithId:function(e,i){i="function"!=typeof i?n:i,gsIndexedDb.fetchSessionBySessionId(e).then((function(e){e&&e.windows?t(e,i):i()}))},validateNewSessionName:i,saveSession:function(e){gsIndexedDb.fetchSessionBySessionId(e).then((function(e){var n=window.prompt(chrome.i18n.getMessage("js_history_enter_name_for_session"));n&&historyUtils.validateNewSessionName(n,(function(t){t&&(e.name=n,gsIndexedDb.addToSavedSessions(e).then((function(){window.location.reload()})))}))}))}}}function t(e,n){let t="";e.windows.forEach((function(e,n){e.tabs.forEach((function(e,n){gsUtils.isSuspendedTab(e)?t+=gsUtils.getOriginalUrl(e.url)+"\n":t+=e.url+"\n"})),t+="\n"}));const i=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(i),o=document.createElement("a");o.setAttribute("href",s),o.setAttribute("download","session.txt"),o.click(),n()}function i(e,n){gsIndexedDb.fetchSavedSessions().then((function(t){if(t.some((function(n,t){return n.name===e}))&&!window.confirm(chrome.i18n.getMessage("js_history_confirm_session_overwrite")))return void n(!1);n(!0)}))}}(this);